<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Data Portal</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #f8f9fa;
      padding: 30px;
      color: #333;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #2c3e50;
    }

    input[type="text"],
    input[type="password"],
    textarea {
      width: 100%;
      max-width: 500px;
      padding: 12px;
      margin: 10px auto;
      display: block;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }

    textarea {
      height: 150px;
      resize: vertical;
    }

    button {
      background-color: #007bff;
      border: none;
      color: white;
      padding: 10px 20px;
      margin: 10px 5px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 6px;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #0056b3;
    }

    .danger {
      background-color: #dc3545;
    }

    .danger:hover {
      background-color: #b02a37;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }

    th {
      background-color: #f1f1f1;
    }

    tr:hover {
      background-color: #f9f9f9;
    }

    .action-btn {
      background-color: #dc3545;
      border: none;
      color: white;
      padding: 4px 8px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 4px;
    }

    .action-btn:hover {
      background-color: #c82333;
    }

    #adminPanel, #logoutBtn {
      display: none;
    }

    .center {
      text-align: center;
    }

    .panel {
      background-color: #ffffff;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      border-radius: 8px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .column-control {
      margin-top: 15px;
      text-align: center;
    }

    .column-control input {
      max-width: 220px;
      display: inline-block;
    }

    .remove-col-btn {
      background: transparent;
      border: none;
      color: #dc3545;
      font-size: 14px;
      margin-left: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>üìö Student Data Portal</h2>

  <input type="text" id="searchInput" placeholder="üîç Search..." />

  <table id="dataTable">
    <thead>
      <tr id="tableHeaders"></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="adminPanel" class="panel">
    <h3>üîê Admin Panel</h3>

    <textarea id="dataInput" placeholder="Paste data rows (tab-separated or double space-separated)"></textarea>
    <div class="center">
      <button onclick="loadData()">üì• Load Data</button>
      <button class="danger" onclick="deleteAll()">üóëÔ∏è Delete All Data</button>
    </div>

    <div class="column-control">
      <input type="text" id="newColumnName" placeholder="New Column Name (e.g. Test Marks)" />
      <button onclick="addColumn()">‚ûï Add Column</button>
    </div>
  </div>

  <div id="loginSection" class="panel center">
    <input type="password" id="adminPassword" placeholder="Enter admin password" />
    <br />
    <button onclick="login()" id="loginBtn">üîì Login</button>
  </div>

  <div class="center">
    <button onclick="logout()" id="logoutBtn">üîí Sign Out</button>
  </div>

  <script>
    const adminPassword = "orbit1112";

    function getColumns() {
      const cols = localStorage.getItem("columns");
      return cols ? JSON.parse(cols) : ["Student Name", "Father Name", "Group", "Phone", "Marks"];
    }

    function saveColumns(cols) {
      localStorage.setItem("columns", JSON.stringify(cols));
    }

    function saveData(data) {
      localStorage.setItem("studentData", JSON.stringify(data));
    }

    function getData() {
      const data = localStorage.getItem("studentData");
      return data ? JSON.parse(data) : [];
    }

    function renderTable() {
      const columns = getColumns();
      const data = getData();
      const isAdmin = sessionStorage.getItem("isAdmin") === "true";

      const thead = document.getElementById("tableHeaders");
      const tbody = document.querySelector("#dataTable tbody");

      thead.innerHTML = "";
      tbody.innerHTML = "";

      columns.forEach((col, index) => {
        const th = document.createElement("th");
        th.textContent = col;

        if (isAdmin && index >= 5) {
          const btn = document.createElement("button");
          btn.innerHTML = "‚ùå";
          btn.className = "remove-col-btn";
          btn.onclick = () => removeColumn(index);
          th.appendChild(btn);
        }

        thead.appendChild(th);
      });

      if (isAdmin) {
        const th = document.createElement("th");
        th.textContent = "Actions";
        thead.appendChild(th);
      }

      data.forEach((row, i) => {
        const tr = document.createElement("tr");

        columns.forEach((_, j) => {
          const td = document.createElement("td");
          td.textContent = row[j] || "";
          tr.appendChild(td);
        });

        if (isAdmin) {
          const td = document.createElement("td");
          const delBtn = document.createElement("button");
          delBtn.textContent = "Delete";
          delBtn.className = "action-btn";
          delBtn.onclick = () => deleteRow(i);
          td.appendChild(delBtn);
          tr.appendChild(td);
        }

        tbody.appendChild(tr);
      });
    }

    function loadData() {
      const input = document.getElementById("dataInput").value.trim();
      const lines = input.split("\n");
      const newRows = lines.map(line => line.split(/\t+|\s{2,}/));

      const columns = getColumns();
      const existing = getData();

      newRows.forEach(row => {
        while (row.length > columns.length) {
          columns.push("Column " + (columns.length + 1));
        }
      });

      saveColumns(columns);
      saveData([...existing, ...newRows]);
      renderTable();
      document.getElementById("dataInput").value = "";
    }

    function deleteRow(index) {
      if (!confirm("Are you sure you want to delete this row?")) return;
      const data = getData();
      data.splice(index, 1);
      saveData(data);
      renderTable();
    }

    function deleteAll() {
      if (!confirm("‚ö†Ô∏è Are you sure to delete ALL data?")) return;
      localStorage.removeItem("studentData");
      renderTable();
    }

    function login() {
      const entered = document.getElementById("adminPassword").value;
      if (entered === adminPassword) {
        sessionStorage.setItem("isAdmin", "true");
        document.getElementById("adminPanel").style.display = "block";
        document.getElementById("logoutBtn").style.display = "inline-block";
        document.getElementById("loginSection").style.display = "none";
        renderTable();
      } else {
        alert("‚ùå Incorrect password");
      }
    }

    function logout() {
      sessionStorage.removeItem("isAdmin");
      document.getElementById("adminPanel").style.display = "none";
      document.getElementById("logoutBtn").style.display = "none";
      document.getElementById("loginSection").style.display = "block";
      renderTable();
    }

    function addColumn() {
      const newCol = document.getElementById("newColumnName").value.trim();
      if (!newCol) return alert("‚ö†Ô∏è Please enter a valid column name");
      const cols = getColumns();
      cols.push(newCol);
      const data = getData();
      const updatedData = data.map(row => {
        row.push("");
        return row;
      });
      saveColumns(cols);
      saveData(updatedData);
      renderTable();
      document.getElementById("newColumnName").value = "";
    }

    function removeColumn(index) {
      if (!confirm("‚ö†Ô∏è Remove this column and its data?")) return;
      const cols = getColumns();
      const data = getData();

      cols.splice(index, 1);
      const updatedData = data.map(row => {
        row.splice(index, 1);
        return row;
      });

      saveColumns(cols);
      saveData(updatedData);
      renderTable();
    }

    document.getElementById("searchInput").addEventListener("keyup", function () {
      const query = this.value.toLowerCase();
      const rows = document.querySelectorAll("#dataTable tbody tr");
      rows.forEach(row => {
        const match = Array.from(row.cells).some(cell =>
          cell.textContent.toLowerCase().includes(query)
        );
        row.style.display = match ? "" : "none";
      });
    });

    renderTable();
  </script>
</body>
</html>
